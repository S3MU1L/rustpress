{% extends "layouts/base.html" %}

{% block title %}Themes - RustPress{% endblock %}

{% block header %}
{% include "partials/nav_admin.html" %}
{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="mb-2">Themes</h1>
    <p class="text-rp-muted">Browse and apply themes to your sites.</p>
  </div>
  <a class="btn-primary" href="/admin/templates/new">Create New Template</a>
</div>

<!-- Filters -->
<div class="card p-4 mb-6">
  <form method="get" action="/admin/themes" class="space-y-4">
    <div class="grid md:grid-cols-2 gap-4">
      <label class="mb-0">
        Apply to Site
        <select name="site_id">
          <option value="">(Select a site)</option>
          {% for s in sites %}
            <option value="{{ s.id }}" {% if selected_site_id.is_some() && selected_site_id.unwrap() == s.id %}selected{% endif %}>{{ s.name }} (/{{ s.slug }})</option>
          {% endfor %}
        </select>
      </label>

      <label class="mb-0">
        Search
        <input name="q" value="{{ query }}" placeholder="Search templates..." />
      </label>
    </div>

    <div class="flex items-center gap-3">
      <button class="btn-primary" type="submit">Filter</button>
      <a class="btn-secondary" href="/admin/themes">Clear</a>

      <div class="flex items-center gap-2 ml-4">
        <span class="text-rp-muted text-sm">Category:</span>
        <a class="badge {% if category == "all" %}bg-rp-accent text-white{% endif %}" href="/admin/themes?category=all{% if query.len() > 0 %}&q={{ query }}{% endif %}{% if selected_site_id.is_some() %}&site_id={{ selected_site_id.unwrap() }}{% endif %}">All</a>
        <a class="badge {% if category == "builtin" %}bg-rp-accent text-white{% endif %}" href="/admin/themes?category=builtin{% if query.len() > 0 %}&q={{ query }}{% endif %}{% if selected_site_id.is_some() %}&site_id={{ selected_site_id.unwrap() }}{% endif %}">Built-in</a>
        <a class="badge {% if category == "custom" %}bg-rp-accent text-white{% endif %}" href="/admin/themes?category=custom{% if query.len() > 0 %}&q={{ query }}{% endif %}{% if selected_site_id.is_some() %}&site_id={{ selected_site_id.unwrap() }}{% endif %}">Custom</a>
      </div>
    </div>
  </form>
</div>

<!-- Templates Grid -->
<div class="card">
  {% if templates.len() == 0 %}
    <div class="p-8 text-center">
      <p class="text-rp-muted">No templates found.</p>
    </div>
  {% else %}
    <ul class="divide-y divide-rp-border">
      {% for t in templates %}
        <li class="p-4 flex items-center justify-between hover:bg-rp-bg/50">
          <div class="flex-1">
            <a href="/admin/templates/{{ t.id }}" class="font-medium">{{ t.name }}</a>
            {% if t.description.len() > 0 %}
              <p class="text-rp-muted text-sm">{{ t.description }}</p>
            {% endif %}
          </div>
          <div class="flex items-center gap-3">
            {% if t.is_builtin %}
              <span class="badge">Built-in</span>
            {% else %}
              <span class="badge badge-success">Custom</span>
            {% endif %}

            {% if selected_site_id.is_some() %}
              <form method="post" action="/admin/sites/{{ selected_site_id.unwrap() }}/theme" hx-post="/admin/sites/{{ selected_site_id.unwrap() }}/theme" hx-swap="none" class="m-0">
                <input type="hidden" name="template" value="{{ t.name }}" />
                <button class="btn-primary text-sm" type="submit">Apply</button>
              </form>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
</div>

<p class="text-rp-muted text-sm mt-4">
  Select a site above to apply a theme directly.
</p>
{% endblock %}
